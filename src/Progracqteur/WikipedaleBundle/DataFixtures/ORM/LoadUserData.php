<?php

namespace Progracqteur\WikipedaleBundle\DataFixtures\ORM;

use Doctrine\Common\Persistence\ObjectManager;
use Doctrine\Common\DataFixtures\AbstractFixture;
use Doctrine\Common\DataFixtures\OrderedFixtureInterface;
use Progracqteur\WikipedaleBundle\Entity\Management\User;
use Progracqteur\WikipedaleBundle\Entity\Management\Group;
use Progracqteur\WikipedaleBundle\Entity\Management\Notation;
use Symfony\Component\DependencyInjection\ContainerAwareInterface;
use Symfony\Component\DependencyInjection\ContainerInterface;

class LoadUserData extends AbstractFixture implements OrderedFixtureInterface, ContainerAwareInterface
{
    /**
     *
     * @var Symfony\Component\DependencyInjection\ContainerInterface 
     */
    private $container;
    
public function getOrder() {
        return 1;
    }
    
public function load(ObjectManager $manager) {
        
        $admin = $this->container->get('fos_user.user_manager')->findUserByUsername('admin');
        $userManager = $this->container->get('fos_user.user_manager');
        
        if ($admin == null)
        {
            echo "création d'un administrateur admin \n";
            
            $admin = $this->container->get('fos_user.user_manager')->createUser();
            $admin->setUsername('admin');
            $admin->setPassword('admin');
            $admin->setEmail('admin@wikipedale.org');
            $admin->addRole(User::ROLE_ADMIN);
            
            $userManager->updateUser($admin);
        } else {
            echo "un utilisateur admin existe déjà \n";
        }
        
        
        $notation = new Notation('gracqmons');
        $notation->setName("Gracq Mons");
        
        $manager->persist($notation);
        
        $g = new Group('GRACq Mons', array('ROLE_NOTATION'));
        $g->setNotation($notation);
        $g->setPolygon("0103000020E61000000100000076000000609CB933D9CF0F40AF20BEEAB1414940A90C5A7A8DE70F40A86D5508D9404940F87175AC88F50F405AF3A8C679404940DCC000975AFE0F40C18299E68F404940350EA2E5AF0D10405B1300C64F4049409001EB47BC111040F84AF12583404940EABDE63096141040887EAB056940494008F88951411610405F9145E6AB404940D2D160164F1A10400F4D40A6E1404940858702968C1A1040CCAEEF45FA404940C183B694241C10401D7F2465054149400DB75390131D1040AD228926EF4049402A0ED6CBDB1F1040B7D25386E74049400E25B5BE2C25104070345D84AA404940BC5B9286B82610402BF05A2350404940DD65BEFF8A2910401F621724FE3F49405485DE7A3D2A1040D11FB803A53F49401DFB0FBECC2D1040580652434D3F49403BA80CED58321040376609802D3E49401B5D086965381040BF20841EC03D49405FEC81BB084010408395627BB03C49402AA37998E73F104071AC1F9C973C4940D268C7A4C43C1040DD447B7B503C4940D07FF13F283B10401A93CABB5A3C49401256D110813B1040A7DB289B3F3C49400E5995F4F354104054EC0A1BBC3B494017FC8C4DAC541040CBB68F58843B4940ACB13303D84F10400ADBDA79AC3B4940D95F83876A4E1040FB3132396B3B49409712CE91044910409136D9D89B3A49408D9FC59C115110405F566C976E3A49406AADF97908521040C22E79761D3A4940FD0C39C6C44F10401D032B57F1394940D4B075F7E75710407387F19323394940F120915E40581040BD4660D5DA3849401BA6E52B965610408D482513AC384940934661A2B54E104064527A9353384940E7E2924A284B1040E16BDD9459384940E58AC3EF084410404ECA9EB58E384940525DC717803F104088D5139575384940E3F2DC2D4C3C104013EFC9B3353849404D6B3B47D83A10408E3B36D27C3749409AC3EDFEF23A1040CE91F0B21037494056D0B57AF83C10407BF46BB1093749405BAE2B701B4010408A01D69045364940464D77A9103E1040BEC8930FD5354940734A024AA93310404FCA69704F354940F3A3BABA3A351040DBB9DC6DDB3449401A7674FBCD3410404F296CAE7C3449406F16851BEC31104086588AAC11344940AA801A1CDD29104052DF2CEEC3334940BE71438D9C2910407A7CFA0C793349401FB16760192B104095E0944B40334940D4BD152689291040B1395E6C4E334940F9EF03DA7323104046085A6BF43249401A800DA2B8251040B8765D2CD3324940CAD2ECA868261040CFC28BCBB0324940AB2E24FD5722104034E35D4A29324940A24C35B3661A104025D6486B45324940D2E9B85D7E141040DE62CFEB41324940797EFFC135101040329E266AFB3149406EEAA7A549051040573E988C2E32494087605C47A104104039AEEA2C143249401FDEABAE940410409AE3C40BB7314940B2541C4DB4051040ED4DDC092331494098B58D2D7D0210408CA21DC90E314940774677F6EC001040A03F4F4B1F314940518784B649F70F403EBC3DCB04314940755804A3E4E70F40737C842A7C304940BD186EE87BD30F402860AF09483049401EA8740785C40F406542F909DC3049401DDD17E39ABB0F40BF3766ED2C32494081003737EABA0F40BEA7204F133349409563F56D38B70F407511DCAFCE3349407FA6651B9AB00F40885FF3100A344940EA7A7E7FEDAA0F405B6B2BB2FB334940B2B6ED5394A20F40B04630308B334940E2D44011B89A0F403BADDE51C8334940EE10EB0AE7710F40EF95C83276344940F9CCEFDC25740F4089711D95CB34494064C077EB5F590F40EF7CC9164C3549400129039BA0470F405598C857CD3549400B4E791483340F4054F7F0583B364940A8CFA1578C1E0F40EEB362D61535494010F756C098150F40F9202B177C354940FCC2A91C41140F40DBB076D9BE354940ACCBED6F5F170F404F42ACB80D364940DB583627FD0D0F40D4EDE07BE83749400FC726160D050F40B572B8FD1A384940C1E99488CBFD0E40837F081DA0384940A0295EE4B7F80E40FF59C65FFC3949401541D76E6DF90E4012408440593A4940736A7963D0020F4092FA4423263B4940025441DD8F010F40892102A4C23B494018FD4601E1040F404286C1C4183C49402C912A7F1D020F4092C1CF26FF3C49407428FD4C40D90E40A85C7127BA3C49405A919E92C4D80E4066835947403D4940B91FF6597DDC0E40502F05E8493D4940BAF3A50E15DF0E401DA5D4887C3D49400801B84BD4F00E405186D66B883F49401EF85FC5DB0B0F4029712ECC6940494064F7C2165A350F403CEC4AEAD83F4940CDAA86DB71470F401515E3CAE03F4940DC11398D1F4F0F402AF9234AF83F49401C2E3EFE7F750F40552BFDE90540494045A8643E64790F409AE34A8A184049402DC5878FE0880F40E4720A07DD3E494006D117315F920F403ED43BC67A3E4940D25718FA4C990F408571D684823E4940D4E2C0918C9C0F405C74E6248D3E494068F77A98FDA60F405DAF72C6683F49404C804D2CBFA60F40C99432A6A13F4940343840EE36A30F40B016B127FA3F4940E252B05A1DAB0F4047BF744A074149409FB8A80D1DBF0F40067A8528F8404940821A7406BDCD0F40F0842C8A62414940609CB933D9CF0F40AF20BEEAB1414940");
        
        $manager->persist($g);
        
        
        
        
        $u = $this->container->get('fos_user.user_manager')->createUser();
        $str = $this->createId();
        $u->setEmail("bicycle@fastre.info");
        $u->setLabel("bicycle");
        $u->setPassword("bicycle");
        $u->addGroup($g);
        
        $userManager->updateUser($u);
        
        $u = $this->container->get('fos_user.user_manager')->createUser();
        $str = $this->createId();
        $u->setEmail("city.$str@fastre.info");
        $u->setLabel("city $str");
        $u->setPassword("admin");
        $u->addRole(User::ROLE_STATUS_CITY);
        
        $userManager->updateUser($u);
        
        $u = $this->container->get('fos_user.user_manager')->createUser();
        $str = $this->createId();
        $u->setEmail("$str@fastre.info");
        $u->setLabel("label $str");
        $u->setPassword($str);
        
        $userManager->updateUser($u);
        $manager->flush();
        
        $this->addReference('user', $u);
    }
    
    
    //cette partie du code sert à créer des chaines de caractères aléatoires
  private $n = array('a', 'b', 'c', 'd', 'e', 'f', 'g', 'h', 'i', 'j', 'k', 'l', 'm', 'n', 'o', 'p', 'q', 'r', 's', 't', 'u', 'v', 'w', 'x', 'y', 'z', '0', '1', '2', '3', '4', '5', '6', '7', '8', '9');

  private $z = array(3);

  public function createId() {
  
  $s = '';
  $d = array_rand($this->z);
  $dd = $this->z[$d];

   for ($i = 0; $i < $dd; $i++) {
     
     $o = array_rand($this->n);
     $s .= $this->n[$o];
   }

  return $s;
  }

    public function setContainer(ContainerInterface $container = null) {
        $this->container = $container;
    }
}

