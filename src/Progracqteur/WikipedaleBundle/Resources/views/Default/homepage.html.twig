{% extends "ProgracqteurWikipedaleBundle::layout.html.twig" %}



{# 

Params passed by the controller to this template :

 'mainCities' (empty if the user has chosen a city) 
         array of Progracqteur\WikipedaleBundle\Entity\Management\Zone
 'cities'  (empty if the user has chosen a city) 
         array of Progracqteur\WikipedaleBundle\Entity\Management\Zone
 'categories' 
         array of Progracqteur\WikipedaleBundle\Entity\Model\Category
 'placeTypes' 
         array of Progracqteur\WikipedaleBundle\Entity\Model\Place\PlaceType
 'managers' (empty if the user has NOT chosen a city)
         array of Progracqteur\WikipedaleBundle\Entity\Management\Group

#}

{% block javascript %}

<script language="javascript"> 
 <!--
    web_dir2 = "{{ asset('js') }}"; // pour remplacer web_dir mais faudrait asset('js') qui ne marche pas

    // color box for connexion
    $(document).ready(function(){

    {% if (app.session.get('city') ) %}
      // adding last modifs
      filling_dernieres_modifs('{{ app.session.get('city').name }}',5);

      {% if goToPlaceId is defined %}
        // map and display place with id
        homepageMap('{{ app.session.get('city').name }}', {{app.session.get('city').center.lon}}, {{app.session.get('city').center.lat}},{{goToPlaceId}});
      {% else %}
        // map and explore
        homepageMap('{{ app.session.get('city').name }}', {{app.session.get('city').center.lon}}, {{app.session.get('city').center.lat}},null);
      {% endif %}

      $("#optionsAffichageCategories").select2();
      $('#optionsAffichageCategories').select2("disable");

      $("#optionsAffichagePlaceTypes").select2();
      $('#optionsAffichagePlaceTypes').select2("disable");

      $("#optionsAffichageStatusCeM").select2();
      $("#optionsAffichageStatusCeM").select2("disable");

      $('#span_place_description_cat_edit').select2();
      $('#span_place_description_status_edit').select2();
      $('#span_place_description_type_edit').select2();
      $('#span_place_description_gestionnaire_edit').select2();

      $('#add_new_description_form__categories').select2().on("change", function(e) { update_add_new_description_form_informer('categories'); });

      $('#optionsAffichageCategories').on("change", function(e) { display_only_markers_with_selected_categories(); });
      $('#optionsAffichagePlaceTypes').on("change", function(e) { display_only_markers_with_selected_categories(); });
      $('#optionsAffichageStatusCeM').on("change", function(e) { display_only_markers_with_selected_categories(); });

      $("#div_returnNormalMode").hide();


      $("#add_new_description_div form").attr("action","javascript:catchForm('#add_new_description_form')")
      $("")
        /* $('#mv').prop('selected', true);
        // $(".chzn-select").trigger('liszt:updated'); (pour selectionner mv) */
    {% else %}


    /*
    var z = dhtmlXComboFromSelect("Cities_dhtmlx");
    z.enableFilteringMode(true);
    */

    {% endif %}

    });
      
    // security
    {% render "ProgracqteurWikipedaleBundle:Token:insertTokens" with {'number':15} %}
// -->
</script>
{% endblock %}


{% block body %}

  {% if (app.session.get('city') ) %}
    {% include "ProgracqteurWikipedaleBundle:Default:map.html.twig" %}
  {% else %}
    {% include "ProgracqteurWikipedaleBundle:Default:accueil.html.twig" %}
  {% endif %}
{% endblock %}
